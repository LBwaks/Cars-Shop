{% extends 'base.html' %}
{% block title %}My Bids{% endblock %}
{% block content %}
{% load static %}
{% load crispy_forms_tags %}
{% load humanize %}


<main id="main">

  <section class="breadcrumbs">        
    <div class="container">
  
      <div class="d-flex justify-content-between align-items-center">
        <h2>My Bids</h2>
        <ol>
          <li><a href="{% url 'home' %}">Home</a></li>
          <li>My Bids</li>
        </ol>
      </div>
    </div>
  </section><!--End of breadcrumb-->

<section id="bid" class="bid" style="min-height:70vh;">
  <div class="container" data-aos="fade-up">

    <div class="row">

      <div class="col-lg-10 mx-auto">
        <br>
      
  <nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
      <button class="nav-link active" id="nav-all-tab" data-bs-toggle="tab" data-bs-target="#nav-all" type="button" role="tab" aria-controls="nav-all" aria-selected="true">All Vehicle Bids</button>
      <button class="nav-link " id="nav-waiting_payment-tab" data-bs-toggle="tab" data-bs-target="#nav-waiting_payment" type="button" role="tab" aria-controls="nav-waiting_payment" aria-selected="false"> Waiting For Payments</button>   
      <button class="nav-link" id="nav-rejected-tab" data-bs-toggle="tab" data-bs-target="#nav-rejected" type="button" role="tab" aria-controls="nav-rejected" aria-selected="false">Rejected Approval</button>
      <button class="nav-link" id="nav-pending-tab" data-bs-toggle="tab" data-bs-target="#nav-pending" type="button" role="tab" aria-controls="nav-pending" aria-selected="false">Pending Vehicle Bids</button>
    </div>
  </nav>
  <div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show " id="nav-waiting_payment" role="tabpanel" aria-labelledby="nav-waiting_payment-tab">
      
      <div class="container">
        <div class="row d-flex align-items-stretch">
        <h3 class="text-center my-4">Vehicle Bids Waiting For Payments</h3>

{% for waiting_payment_bid in waiting_payment_bids%}
<div class="col-md-6 col-lg-6 col-sm-12">
  <div class="card shadow  mb-5 bg-body rounded py-1  my-3"> 
    <div class="card-body">
      <h5 class="card-title">Vehicle : <a class="text-warning fs-5 fw-bold text-uppercase text-decoration-none" href="{{waiting_payment_bid.car.get_absolute_url}}">{{waiting_payment_bid.car.category}} ,{{waiting_payment_bid.car.car_name}} </a> </h5>
      <ul class="list-unstyled">
        <li  class="lh-lg"><span class="fw-bold"> Vehicle StockId : </span> <span class="fw-lighter fst-italic ml-3">{{waiting_payment_bid.car.stock_id}}</span></li>
         
              <li  class="lh-lg"><span class="fw-bold"> Your Bid Price : </span> <span class="fw-light ml-3">Ksh {{waiting_payment_bid.price |intcomma}}</span></li>
              {% if waiting_payment_bid.description %}  
              <li  class="lh-lg"><span class="fw-bold"> Reason For Your Price : </span> <span class="fw-light ml-3">{{waiting_payment_bid.description|safe}}</span></li>
   {% endif%}
   <li  class="lh-lg"><span class="fw-bold"> Bid Status : </span> <span class="fw-light text-success fs-6 fw-bold ml-3">{{waiting_payment_bid.status}}</span></li>

</ul>
<div class="d-grid gap-2 d-md-flex justify-content-md-between">
  <a href=" {% url 'buy_car' waiting_payment_bid.slug %}"  class="btn btn-sm btn-outline-success">Buy Vehicle </a> 
   <a href="{% url 'reject_approval' waiting_payment_bid.slug %}" class="btn btn-outline-primary">Reject Bid Approval</a>
   </div>

</div>
</div>
</div>
{% empty %}
<div class="col-md-12">
  <div class="card py-1  my-3"> 
    <div class="card-body text-center">
   
      <p class="card-text"> You Have No Car Bid Waiting For Payments!</p>
      
    </div>
  </div>
  </div>


{% endfor %}
</div>
</div>
    </div>






    <div class="tab-pane fade show active" id="nav-all" role="tabpanel" aria-labelledby="nav-all-tab">
       
      <div class="container">
        <div class="row d-flex align-items-stretch">
        <h3 class="text-center my-4">All Bids</h3>
      {% comment %} <h3></h3> {% endcomment %}
{% for all_bid in all_bids%}


<div class="col-md-6 col-lg-6 col-sm-12">
  <div class="card shadow  mb-5 bg-body rounded py-1  my-3"> 
    <div class="card-body">
      <h5 class="card-title">Vehicle : <a class="text-warning fs-5 fw-bold text-uppercase text-decoration-none" href="{{all_bid.car.get_absolute_url}}">{{all_bid.car.category}} ,{{all_bid.car.car_name}} </a> </h5>
      
      <ul class="list-unstyled">
        <li  class="lh-lg"><span class="fw-bold"> Vehicle StockId : </span> <span class="fw-lighter fst-italic ml-3">{{all_bid.car.stock_id}}</span></li>
         
              <li  class="lh-lg"><span class="fw-bold"> Your Bid Price : </span> <span class="fw-light ml-3">Ksh {{all_bid.price |intcomma}}</span></li>
              {% if all_bid.description %}  
              <li  class="lh-lg"><span class="fw-bold"> Reason For Your Price : </span> <span class="fw-light ml-3">{{all_bid.description|safe}}</span></li>
   {% endif%}
   <li  class="lh-lg"><span class="fw-bold"> Bid Status : </span> <span class="fw-light text-info fs-6 fw-bold ml-3">{{all_bid.status}}</span></li>

</ul>
{% if all_bid.status == 'WAITING PAYMENT'%}
<div class="d-grid gap-2 d-md-flex justify-content-md-between">
  {% comment %} <button id="paypal-button-container" class="btn btn-sm btn-outline-success">Buy Car 22 </button> 
  <div id="paypal-button-container"></div> {% endcomment %}
  <a href=" {% url 'buy_car' all_bid.slug %}"  class="btn btn-sm btn-outline-success">Buy Vehicle </a> 
  {% comment %} <div id="paypal-button-container"></div> {% endcomment %}
   <a href="{% url 'reject_approval' all_bid.slug %}" class="btn btn-outline-primary">Reject Bid Approval</a>
   </div>
   {% endif %}

</div>
</div>
</div>




{% empty %}
<div class="col-md-12">
  <div class="card py-1  my-3"> 
    <div class="card-body text-center">
   
      <p class="card-text"> You Have No Car Bid !</p>
      
    </div>
  </div>
  </div>
{% endfor %}
    </div>
  </div>
  
         
            
            {% if all_bids %} <!---- check if there are object for pagination-->
            <nav aria-label="Page navigation ">
              <ul class="pagination justify-content-end">
              {% if all_bids.has_previous %}
                  <li>
      {% comment %} <a  href="?page={{ all_bids.previous_page_number }}">        <span >&laquo;</span>      </a> {% endcomment %}
      <a class="page-link" href="?page={{ all_bids.previous_page_number }}" tabindex="-1" aria-disabled="true">Previous</a>
    </li>    
    {% endif %}

                  {% for i in all_bids.paginator.page_range %}
             {% if all_bids.number == i %}
             <li class="page-item active" aria-current="page"> <span class="page-link">{{i}}</span> </li>
                {% comment %} <li class="active"><a href="#">{{i}}</a></li> {% endcomment %}
                {% else %}
                  {% comment %} <li ><a href="?page={{i}}">{{i}}</a></li> {% endcomment %}
                  <li class="page-item"><a class="page-link" href="?page={{i}}">{{i}}</a></li>
              {% endif %}
              {% endfor %}
              {% if all_bids.has_next %}          
              {% comment %} <li>    <a href="?page={{ all_bids.next_page_number }}">&raquo;</a>  </li>  {% endcomment %}
              <li class="page-item">                <a class="page-link" href="?page={{ all_bids.next_page_number }}">Next</a>              </li>
  {% endif %}
              </ul>
              <br>
            </div>

            {% endif %}











    <div class="tab-pane fade" id="nav-rejected" role="tabpanel" aria-labelledby="nav-rejected-tab">
      <div class="container">
        <div class="row d-flex align-items-stretch">
        <h3 class="text-center my-4">Vehicle Bids Approval You Rejected </h3>
  
  

  {% for rejected_bid in rejected_bids %}

  <div class="col-md-6 col-lg-6 col-sm-12">
    <div class="card py-1  my-3"> 
      <div class="card-body">
        <h5 class="card-title">Vehicle : <a class="text-warning fs-5 fw-bold text-uppercase text-decoration-none" href="{{all_bid.car.get_absolute_url}}">{{rejected_bid.car.category}} ,{{rejected_bid.car.car_name}} </a> </h5>
        <ul class="list-unstyled">
          <li  class="lh-lg"><span class="fw-bold"> Vehicle StockId : </span> <span class="fw-lighter fst-italic ml-3">{{rejected_bid.car.stock_id}}</span></li>
           
                <li  class="lh-lg"><span class="fw-bold"> Your Bid Price : </span> <span class="fw-light ml-3">Ksh {{rejected_bid.price |intcomma}}</span></li>
                {% if rejected_bid.description %}  
                <li  class="lh-lg"><span class="fw-bold"> Reason For Your Price : </span> <span class="fw-light ml-3">{{rejected_bid.description|safe}}</span></li>
     {% endif%}
     <li  class="lh-lg"><span class="fw-bold"> Bid Status : </span> <span class="fw-light text-danger fs-6 fw-bold ml-3">{{rejected_bid.status}}</span></li>
  
  </ul>
  
  </div>
  </div>
  </div>

{% empty %}
<div class="col-md-12">
  <div class="card py-1  my-3"> 
    <div class="card-body text-center">
   
      <p class="card-text"> You Have Not Rejected Any Car Bid Approval !</p>
      
    </div>
  </div>
  </div>
{% endfor %}

</div></div>
    </div>
    <div class="tab-pane fade" id="nav-pending" role="tabpanel" aria-labelledby="nav-pending-tab">

      <div class="container">
        <div class="row d-flex align-items-stretch">
        <h3 class="text-center my-4">Pending Cars Bids</h3>
     

      {% for pending_bid in pending_bids %}
      <div class="col-md-6 col-lg-6 col-sm-12">
        <div class="card py-1  my-3"> 
          <div class="card-body">
            <h5 class="card-title">Vehicle : <a class="text-warning fs-5 fw-bold text-uppercase text-decoration-none" href="{{all_bid.car.get_absolute_url}}">{{pending_bid.car.category}} ,{{pending_bid.car.car_name}} </a> </h5>
            <ul class="list-unstyled">
              <li  class="lh-lg"><span class="fw-bold"> Car StockId : </span> <span class="fw-lighter fst-italic ml-3">{{pending_bid.car.stock_id}}</span></li>
               
                    <li  class="lh-lg"><span class="fw-bold"> Your Bid Price : </span> <span class="fw-light ml-3">Ksh {{pending_bid.price |intcomma}}</span></li>
                    {% if pending_bid.description %}  
                    <li  class="lh-lg"><span class="fw-bold"> Reason For Your Price : </span> <span class="fw-light ml-3">{{pending_bid.description|safe}}</span></li>
         {% endif%}
         <li  class="lh-lg"><span class="fw-bold"> Bid Status : </span> <span class="fw-light text-black-50 fs-6 fw-bold ml-3">{{pending_bid.status}}</span></li>
      
      </ul>
      <div class="d-grid gap-2 d-md-flex justify-content-md-between">
        <a href="{% url 'edit_bid' pending_bid.slug %} " class="btn btn-sm btn-outline-warning">Edit </a> 
         <a href="" class="btn btn-outline-danger">Delete</a>
         </div>
      </div>
      </div>
      </div>
{% empty %}
<div class="col-md-12">
  <div class="card py-1  my-3"> 
    <div class="card-body text-center">
   
      <p class="card-text"> You Have Not Rejected Any Car Bid Approval !</p>
      
    </div>
  </div>
  </div>
{% endfor %}
    </div>
  </div>
</div>


    
  </div>
  </div>

  
</div><!-- End bid entries list -->

          
</div>


</section><!-- End Bid Section -->


</main><!-- End #main -->
{% block scripts%}
<script src="https://www.paypal.com/sdk/js?client-id=test&currency=USD"></script>
<script>
    paypal.Buttons({
      // Sets up the transaction when a payment button is clicked
      createOrder: (data, actions) => {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: '{{waiting_payment_bid.price |intcomma}} ' // Can also reference a variable or function
            }
          }]
        });
      },
      // Finalize the transaction after payer approveaderal
      onApprove: (data, actions) => {
        return actions.order.capture().then(function(orderData) {
          // Successful capture! For dev/demo purposes:
          console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
          const transaction = orderData.purchase_units[0].payments.captures[0];
          alert(`Transaction ${transaction.status}: ${transaction.id}\n\nSee console for all available details`);
          // When ready to go live, remove the alert and show a success message within this page. For example:
          // const element = document.getElementById('paypal-button-container');
          // element.innerHTML = '<h3>Thank you for your payment!</h3>';
          // Or go to another URL:  actions.redirect('thank_you.html');
        });
      }
    }).render('#paypal-button-container');
  </script>


  
{% endblock %}

{% endblock %}